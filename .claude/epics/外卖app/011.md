---
id: 11
title: 创建全新的Flutter项目（包含iOS和Android支持）
status: completed
priority: high
labels: [flutter, ios, android, setup]
assigned:
estimate: 8h
dependencies: []
completed: 2025-12-31T16:45:00Z
---

# 任务011: 创建全新的Flutter项目（包含iOS和Android支持）

## 目标
创建一个全新的Flutter项目，同时启用iOS和Android平台支持，为后续代码迁移打下坚实基础。

## 背景说明
在现有Flutter项目上添加iOS和Android平台支持比较困难，采用更实际的方案：
1. 从零创建包含iOS和Android的新Flutter项目
2. 确保平台配置正确且最新
3. 然后迁移现有代码到新项目

这样更高效且能避免配置问题。

## 详细任务

### 1. 创建新的Flutter项目 (1h)

**步骤**:
```bash
cd /Volumes/545S/general final
flutter create --platforms=ios,android flutter_app_new
```

**项目配置**:
- 项目名称: flutter_app_new
- 组织: com.restaurant
- 描述: 餐厅外卖配送应用
- 平台: iOS + Android

**验证**:
```bash
cd flutter_app_new
flutter doctor
```

### 2. 配置项目依赖 (1h)

**复制依赖配置**:
- 从 `flutter_app/pubspec.yaml` 复制所有依赖包
- 更新版本号到最新稳定版
- 添加新项目需要的依赖

**关键依赖**:
```yaml
dependencies:
  flutter:
    sdk: flutter

  # 状态管理
  provider: ^6.1.0

  # 网络请求
  dio: ^5.4.0

  # 本地存储
  hive: ^2.2.3
  hive_flutter: ^1.1.0
  shared_preferences: ^2.2.2

  # UI组件
  cached_network_image: ^3.3.0

  # 工具
  logger: ^2.0.2
  intl: ^0.19.0

dev_dependencies:
  flutter_test:
    sdk: flutter
  flutter_lints: ^3.0.0
  build_runner: ^2.4.6
  json_serializable: ^6.7.1
  hive_generator: ^2.0.1
```

**安装依赖**:
```bash
flutter pub get
```

### 3. 创建项目目录结构 (1h)

**Clean Architecture结构**:
```
flutter_app_new/
├── lib/
│   ├── core/
│   │   ├── config/
│   │   │   ├── dio_config.dart
│   │   │   ├── hive_config.dart
│   │   │   └── api_constants.dart
│   │   ├── constants/
│   │   │   ├── storage_constants.dart
│   │   │   └── app_constants.dart
│   │   └── utils/
│   │       └── storage_util.dart
│   ├── data/
│   │   ├── models/
│   │   │   ├── user.dart
│   │   │   ├── product.dart
│   │   │   ├── category.dart
│   │   │   ├── cart_item.dart
│   │   │   ├── order.dart
│   │   │   ├── address.dart
│   │   │   └── review.dart
│   │   └── repositories/
│   ├── presentation/
│   │   ├── providers/
│   │   │   ├── auth_provider.dart
│   │   │   ├── cart_provider.dart
│   │   │   ├── product_provider.dart
│   │   │   ├── order_provider.dart
│   │   │   ├── theme_provider.dart
│   │   │   ├── address_provider.dart
│   │   │   ├── favorite_provider.dart
│   │   │   └── review_provider.dart
│   │   ├── pages/
│   │   ├── routes/
│   │   └── widgets/
│   └── services/
│       ├── api_service.dart
│       └── mock_service.dart
├── ios/
├── android/
└── test/
```

**创建所有空文件**:
```bash
# 创建目录
mkdir -p lib/{core/{config,constants,utils},data/{models,repositories},presentation/{providers,pages,routes,widgets},services}

# 创建占位文件
touch lib/core/config/.gitkeep
# ... (创建所有目录的.gitkeep文件)
```

### 4. 配置iOS平台 (1.5h)

**修改 ios/Runner/Info.plist**:
- 设置Bundle Identifier: `com.restaurant.deliveryapp`
- 配置应用名称: `美食外卖`
- 配置权限:
  - 相机权限
  - 相册权限
  - 位置权限
  - 通知权限

**配置 ios/Podfile**:
```ruby
platform :ios, '13.0'

target 'Runner' do
  use_frameworks!
  flutter_install_all_ios_pods File.dirname(File.realpath(__FILE__))
end
```

**安装iOS依赖**:
```bash
cd ios
pod install
cd ..
```

### 5. 配置Android平台 (1.5h)

**修改 android/app/src/main/AndroidManifest.xml**:
- 设置包名: `com.restaurant.deliveryapp`
- 配置应用权限
- 配置应用名称

**修改 android/app/build.gradle**:
```gradle
android {
    compileSdkVersion 34

    defaultConfig {
        applicationId "com.restaurant.deliveryapp"
        minSdkVersion 21
        targetSdkVersion 34
        versionCode 1
        versionName "1.0.0"
    }
}
```

### 6. 配置开发环境 (1h)

**创建 .vscode/settings.json**:
```json
{
  "dart.lineLength": 120,
  "files.exclude": {
    "**/.git": true,
    "**/.svn": true,
    "**/.hg": true,
    "**/.*": true
  }
}
```

**创建 analysis_options.yaml**:
```yaml
include: package:flutter_lints/
linter:
  rules:
    - prefer_const_constructors
    - prefer_const_declarations
    - avoid_print
```

**创建 .gitignore**:
```
# IDE
.idea/
.vscode/

# Flutter/Dart/Pub
.dart_tool/
.pub/
build/
.flutter-plugins
.flutter-plugins-dependencies

# Android/iOS
android/.gradle
android/local.properties
ios/Pods/
```

### 7. 验证双平台空白项目 (1h)

**iOS测试**:
```bash
# 启动iOS模拟器
open -a Simulator

# 运行Flutter应用
flutter run -d ios
```

**Android测试**:
```bash
# 启动Android模拟器
emulator -avd test_avd &

# 运行Flutter应用
flutter run -d android
```

**验证清单**:
- [ ] ✅ iOS空白应用可以运行
- [ ] ✅ Android空白应用可以运行
- [ ] ✅ 热重载功能正常
- [ ] ✅ 无编译错误
- [ ] ✅ 项目结构清晰

### 8. 创建配置文档 (1h)

**创建 PROJECT_SETUP.md**:
- 项目创建步骤
- 依赖安装说明
- iOS配置说明
- Android配置说明
- 常见问题解决

**创建 MIGRATION_GUIDE.md**:
- 代码迁移计划
- 文件迁移顺序
- 依赖关系处理

## 验收标准

### 必须满足
- [ ] ✅ 新Flutter项目创建成功
- [ ] ✅ iOS和Android平台同时启用
- [ ] ✅ 项目目录结构创建完成
- [ ] ✅ 所有依赖包安装成功
- [ ] ✅ iOS空白应用在Simulator上运行
- [ ] ✅ Android空白应用在Emulator上运行
- [ ] ✅ 配置文档完整

### 质量标准
- [ ] 项目结构清晰，符合Clean Architecture
- [ ] 所有配置文件正确
- [ ] 无编译警告和错误
- [ ] 文档详细易懂

## 工作目录
```
/Volumes/545S/general final/flutter_app_new
```

## 依赖关系
- 无依赖，可立即开始

## 注意事项
1. 新项目创建在flutter_app_new/目录
2. 保留原flutter_app/目录作为代码来源
3. 确保Flutter SDK版本兼容
4. iOS开发需要macOS环境
5. Android开发可在任何平台上进行

## 下一步
完成本项目创建后，继续任务012（迁移代码）

## 参考资源
- [Flutter项目创建](https://docs.flutter.dev/development/platform-integration/platform-channels)
- [Flutter iOS配置](https://docs.flutter.dev/deployment/ios)
- [Flutter Android配置](https://docs.flutter.dev/deployment/android)
