---
id: 13
title: 双平台测试和验证
status: completed
priority: high
labels: [flutter, ios, android, testing]
assigned:
estimate: 20h
dependencies: [12]
completed: 2025-12-31T23:59:00Z
---

# 任务013: 双平台测试和验证

## 目标
在iOS和Android平台上进行全面的应用测试，验证所有功能在双平台上正常运行，修复平台特定问题，并确保性能达标。

## 背景说明
任务012已完成代码迁移，现在需要在iOS和Android平台上进行完整的功能测试、性能测试和兼容性测试，确保应用在双平台上都能稳定运行。

## 详细任务

### 1. iOS平台测试 (5h)

#### iOS设备准备
- [ ] 启动iOS模拟器
  ```bash
  open -a Simulator
  ```
- [ ] 准备多种测试设备
  - iPhone 15 Pro (最新设备)
  - iPhone 12 (中等设备)
  - iPhone SE (小屏设备)
  - iPad Pro (平板，可选)

#### 功能测试流程
**1. 认证流程测试** (30分钟)
- [ ] 新用户注册
  - 手机号输入
  - 验证码验证（使用1234）
  - 密码设置
  - 注册成功跳转
- [ ] 用户登录
  - 手机号登录
  - 验证码验证
  - 自动登录功能
- [ ] 退出登录
- [ ] Token持久化验证

**2. 商品浏览测试** (1小时)
- [ ] 首页加载
  - 分类列表显示
  - 推荐商品显示
  - 轮播图（如有）
- [ ] 商品分类浏览
  - 分类切换
  - 分类下商品列表
- [ ] 商品详情
  - 商品图片显示
  - 价格、描述显示
  - 添加到购物车
  - 收藏功能
- [ ] 商品搜索
  - 关键词搜索
  - 搜索结果显示
  - 搜索历史

**3. 购物车测试** (30分钟)
- [ ] 添加商品到购物车
- [ ] 修改商品数量
- [ ] 删除商品
- [ ] 购物车金额计算
- [ ] 购物车状态持久化

**4. 订单流程测试** (1小时)
- [ ] 外卖下单
  - 选择配送地址
  - 填写配送信息
  - 选择支付方式（模拟支付）
  - 提交订单
- [ ] 到店自取
  - 填写取餐人信息
  - 选择取餐时间
  - 提交订单
- [ ] 订单列表
  - 进行中订单
  - 历史订单
- [ ] 订单详情
  - 订单状态跟踪
  - 订单取消功能
  - 订单金额明细

**5. 评价功能测试** (30分钟)
- [ ] 提交评价
  - 星级评分
  - 文字评价
  - 图片上传（可选）
- [ ] 查看评价列表
- [ ] 评价显示验证

**6. 个人中心测试** (30分钟)
- [ ] 个人信息显示
- [ ] 订单历史
- [ ] 地址管理
  - 添加新地址
  - 编辑地址
  - 删除地址
  - 设置默认地址
- [ ] 收藏列表
- [ ] 退出登录

#### iOS特定功能测试
- [ ] SafeArea适配
  - 刘海屏适配
  - Home Indicator适配
- [ ] iOS手势导航
  - 返回手势
  - 多任务切换
- [ ] iOS权限请求
  - 相机权限
  - 相册权限
  - 通知权限
- [ ] iOS深色模式
  - 浅色/深色主题切换
  - 主题持久化
- [ ] iOS通知
  - 推送通知接收（可选）
- [ ] iOS键盘类型
  - 数字键盘
  - 电话号码键盘

### 2. Android平台测试 (5h)

#### Android设备准备
- [ ] 启动Android模拟器
  ```bash
  flutter emulators
  flutter emulators --launch <emulator_id>
  ```
- [ ] 准备多种测试设备
  - Pixel 8 Pro (Android 14，最新)
  - Samsung Galaxy S23 (Android 13)
  - 小米 Redmi (Android 11)
  - Android平板（可选）

#### 功能测试流程
**与iOS相同的功能测试** (3小时)
- [ ] 认证流程测试
- [ ] 商品浏览测试
- [ ] 购物车测试
- [ ] 订单流程测试
- [ ] 评价功能测试
- [ ] 个人中心测试

#### Android特定功能测试
- [ ] Material Design组件
  - Button样式
  - TextField样式
  - Card样式
  - Snackbar/Toast
- [ ] Android返回键
  - 返回键导航
  - 双击返回退出（可选）
  - 返回栈管理
- [ ] Android权限请求
  - 运行时权限请求
  - 权限说明对话框
  - 拒绝权限处理
- [ ] Android通知权限
  - Android 13+ POST_NOTIFICATIONS权限
- [ ] Android键盘
  - 键盘弹出处理
  - 键盘遮挡问题
- [ ] Android多窗口
  - 分屏模式
  - 画中画模式（可选）

### 3. 性能测试 (3h)

#### 使用Flutter DevTools

**启动DevTools**:
```bash
flutter pub global activate devtools
flutter pub global run devtools
```

#### iOS性能指标测试
- [ ] 启动时间
  - 冷启动时间 < 3秒
  - 热启动时间 < 1秒
- [ ] 页面切换
  - 页面切换流畅度60fps
  - 转场动画无卡顿
- [ ] 内存占用
  - 正常使用 < 150MB
  - 峰值内存 < 200MB
- [ ] CPU使用率
  - 空闲状态 < 10%
  - 滚动列表 < 40%
- [ ] 电池消耗
  - 正常使用30分钟消耗合理
- [ ] 网络性能
  - API响应时间 < 500ms
  - 图片加载速度

#### Android性能指标测试
- [ ] 启动时间
  - 冷启动时间 < 3秒
  - 热启动时间 < 1秒
- [ ] 页面切换
  - 页面切换流畅度60fps
  - 转场动画无卡顿
- [ ] 内存占用
  - 正常使用 < 200MB
  - 峰值内存 < 250MB
- [ ] APK大小
  - Release APK < 50MB
  - App Bundle优化
- [ ] CPU和电池测试（同iOS）

#### 使用Flutter Performance工具
```bash
# 运行性能分析
flutter run --profile
```

### 4. 兼容性测试 (2h)

#### 屏幕尺寸适配
- [ ] iOS设备
  - iPhone SE (小屏 375x667)
  - iPhone 15 Pro (中屏 393x852)
  - iPhone 15 Pro Max (大屏 430x932)
  - iPad Pro (平板 1024x1366)
- [ ] Android设备
  - 小屏 (360x640)
  - 中屏 (360x800)
  - 大屏 (412x915)
  - 平板 (800x1280)

#### 横竖屏测试
- [ ] iOS横竖屏切换
  - 自动旋转
  - 锁定方向
- [ ] Android横竖屏切换
  - 自动旋转
  - 配置变更处理

#### 不同分辨率测试
- [ ] 1x分辨率
- [ ] 2x分辨率
- [ ] 3x分辨率
- [ ] 4x分辨率

#### 系统版本测试
- [ ] iOS版本
  - iOS 17（最新）
  - iOS 16
  - iOS 15（最低支持）
- [ ] Android版本
  - Android 14（最新）
  - Android 13
  - Android 11（最低支持）

### 5. Bug修复和优化 (4h)

#### Bug整理和分类
**使用表格记录所有发现的Bug**:

| Bug ID | 严重性 | 平台 | 问题描述 | 状态 |
|--------|--------|------|----------|------|
| BUG-001 | P0 | iOS | 启动崩溃 | 待修复 |
| BUG-002 | P1 | Android | 购物车金额计算错误 | 待修复 |
| BUG-003 | P2 | Both | 页面切换卡顿 | 待修复 |

#### 优先级定义
- **P0 (阻塞性)**: 崩溃、无法使用、数据丢失
- **P1 (严重)**: 核心功能异常、严重影响体验
- **P2 (一般)**: 次要功能问题、体验问题
- **P3 (微小)**: UI细节、文案问题

#### Bug修复流程
**1. P0级别Bug修复** (优先)
- [ ] 识别所有P0 Bug
- [ ] 逐个修复P0 Bug
- [ ] 回归测试验证修复
- [ ] 确认无新Bug引入

**2. P1级别Bug修复**
- [ ] 识别所有P1 Bug
- [ ] 逐个修复P1 Bug
- [ ] 回归测试验证修复

**3. P2级别Bug修复**
- [ ] 识别所有P2 Bug
- [ ] 修复重要P2 Bug
- [ ] 记录剩余P2 Bug

**4. 平台特定Bug修复**
- [ ] iOS特定Bug
  - SafeArea问题
  - iOS权限问题
  - iOS样式问题
- [ ] Android特定Bug
  - Material Design问题
  - Android权限问题
  - 返回键问题
- [ ] 跨平台统一Bug
  - 业务逻辑错误
  - 数据同步问题
  - 网络请求问题

#### 性能优化
- [ ] 启动速度优化
  - 延迟初始化非必要组件
  - 优化应用初始化流程
- [ ] 页面渲染优化
  - 使用const构造函数
  - 避免不必要的rebuild
  - 使用ListView.builder
- [ ] 图片加载优化
  - 使用cached_network_image
  - 图片缓存策略
  - 图片压缩
- [ ] 内存优化
  - 及时释放资源
  - 优化列表滚动
  - 避免内存泄漏

#### UI/UX优化
- [ ] iOS风格优化
  - 符合iOS HIG规范
  - 使用iOS风格的对话框
  - 适配iOS动画曲线
- [ ] Android风格优化
  - 符合Material Design规范
  - 使用Material组件
  - 适配Ripple效果
- [ ] 统一交互体验
  - 加载状态提示
  - 错误提示优化
  - 成功反馈优化
- [ ] 动画优化
  - 页面转场动画
  - 列表滑动动画
  - 按钮点击反馈

### 6. Release构建测试 (1h)

#### iOS Release构建
```bash
flutter build ios --release
```

**验证**:
- [ ] Archive成功
- [ ] 无编译警告
- [ ] App大小合理
- [ ] 在iOS模拟器上运行
  ```bash
  open -a Simulator
  flutter run -d ios --release
  ```

#### Android Release构建
```bash
# 构建APK
flutter build apk --release

# 构建App Bundle (推荐)
flutter build appbundle --release
```

**验证**:
- [ ] APK/AAB构建成功
- [ ] APK大小 < 50MB
- [ ] 在Android模拟器上运行
  ```bash
  flutter run -d android --release
  ```

#### Release版本测试
- [ ] 功能完整性验证
- [ ] 性能指标验证
- [ ] 无明显Bug
- [ ] 日志输出正常
- [ ] 网络请求正常
- [ ] 本地存储正常

## 验收标准

### 必须满足
- [ ] ✅ iOS和Android平台所有功能测试通过
- [ ] ✅ 无P0/P1级别Bug
- [ ] ✅ 性能指标满足要求
  - 启动时间 < 3秒
  - 页面切换60fps
  - 内存占用在合理范围
- [ ] ✅ Release版本构建成功
- [ ] ✅ 双平台应用可以独立安装运行
- [ ] ✅ 平台特定功能正常工作
  - iOS: SafeArea、手势导航、权限请求
  - Android: 返回键、Material Design、权限请求

### 质量标准
- [ ] P0 Bug数量 = 0
- [ ] P1 Bug数量 = 0
- [ ] P2 Bug数量 ≤ 5
- [ ] iOS崩溃率 = 0
- [ ] Android崩溃率 = 0
- [ ] 页面加载流畅无卡顿
- [ ] 网络请求成功率 ≥ 99%

### 测试覆盖率
- [ ] 核心功能覆盖率 100%
- [ ] 次要功能覆盖率 ≥ 90%
- [ ] 平台特定功能覆盖率 100%

## 测试设备矩阵

### iOS测试设备
| 设备型号 | 屏幕尺寸 | iOS版本 | 优先级 |
|---------|---------|---------|--------|
| iPhone 15 Pro | 6.1" | iOS 17 | P0 |
| iPhone 12 | 6.1" | iOS 16 | P1 |
| iPhone SE | 4.7" | iOS 15 | P1 |
| iPad Pro | 12.9" | iOS 17 | P2 |

### Android测试设备
| 设备型号 | 屏幕尺寸 | Android版本 | 优先级 |
|---------|---------|-------------|--------|
| Pixel 8 Pro | 6.7" | Android 14 | P0 |
| Samsung S23 | 6.1" | Android 13 | P1 |
| Xiaomi Redmi | 6.5" | Android 11 | P1 |

## 工作目录
```
/Volumes/545S/general final/flutter_app_new
```

## 依赖关系
- 依赖任务011（新Flutter项目创建）
- 依赖任务012（代码迁移完成）
- 依赖任务001-010（所有核心功能已开发）

## 注意事项
1. 测试时使用真实后端API，确保网络请求正常
2. 如遇Bug，先记录后修复，避免遗漏
3. 优先修复P0和P1级别Bug
4. iOS测试需要macOS环境和Xcode
5. Android测试可在任何平台进行
6. 性能测试使用Flutter DevTools
7. 保留Bug追踪记录，便于后续优化
8. 测试过程中截图/录屏，便于问题复现

## 常见问题解决

### 问题1: iOS启动崩溃
**可能原因**:
- 缺少iOS权限配置
- 第三方库配置问题
- 代码错误

**解决方法**:
1. 检查Xcode控制台日志
2. 检查Info.plist配置
3. 使用flutter doctor验证环境

### 问题2: Android返回键异常
**解决方法**:
```dart
// 正确处理返回键
WillPopScope(
  onWillPop: () async {
    // 自定义返回逻辑
    return true;
  },
  child: ...,
)
```

### 问题3: 性能卡顿
**解决方法**:
- 使用Flutter DevTools分析性能瓶颈
- 优化列表渲染（使用ListView.builder）
- 减少不必要的rebuild
- 使用const构造函数

### 问题4: SafeArea问题
**解决方法**:
```dart
// 包裹SafeArea
SafeArea(
  child: Scaffold(...),
)
```

### 问题5: 权限请求失败
**解决方法**:
- iOS: 检查Info.plist权限描述
- Android: 检查AndroidManifest.xml权限声明
- 确保运行时权限请求逻辑正确

## 测试检查清单

### iOS功能清单
- [ ] 用户注册登录
- [ ] 商品浏览和搜索
- [ ] 购物车功能
- [ ] 订单创建和支付
- [ ] 订单状态跟踪
- [ ] 订单评价
- [ ] 地址管理
- [ ] 收藏功能
- [ ] SafeArea适配
- [ ] iOS手势导航
- [ ] iOS权限请求
- [ ] 深色模式

### Android功能清单
- [ ] 用户注册登录
- [ ] 商品浏览和搜索
- [ ] 购物车功能
- [ ] 订单创建和支付
- [ ] 订单状态跟踪
- [ ] 订单评价
- [ ] 地址管理
- [ ] 收藏功能
- [ ] Material Design适配
- [ ] 返回键导航
- [ ] Android权限请求
- [ ] 通知权限（Android 13+）

## 下一步
完成双平台测试后，应用已具备发布条件。可以选择：
1. 继续进行应用商店发布（App Store + Google Play）
2. 或先进行内部测试/Beta测试
3. 根据测试反馈进行进一步优化

## 参考资源
- [Flutter测试最佳实践](https://docs.flutter.dev/cookbook/testing)
- [Flutter性能优化](https://docs.flutter.dev/perf)
- [Flutter DevTools](https://docs.flutter.dev/tools/devtools/overview)
- [iOS人机界面指南](https://developer.apple.com/design/human-interface-guidelines/)
- [Material Design指南](https://m3.material.io/)
