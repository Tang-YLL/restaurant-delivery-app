---
id: 12
title: Android平台配置和构建
status: pending
priority: high
labels: [flutter, android, build]
assigned:
estimate: 12h
dependencies: [6, 7]
---

# 任务012: Android平台配置和构建

## 目标
配置Flutter项目的Android平台，确保可以在Android设备上运行，并满足Google Play发布要求。

## 背景说明
PRD新增要求：Flutter应用必须同时支持iOS和Android双平台。当前Flutter项目已完成基础开发，需要配置Android平台并进行构建测试。

## 详细任务

### 1. Android开发环境配置 (2h)
- [ ] 验证Android Studio安装（要求 ≥ Hedgehog | 2023.1.1）
- [ ] 验证Flutter Android开发环境
  ```bash
  flutter doctor
  flutter doctor --verbose
  ```
- [ ] 验证Android SDK安装
  - Android SDK Platform-Tools
  - Android SDK Build-Tools
  - Android SDK 34 (API Level 34)
- [ ] 配置ANDROID_HOME环境变量
- [ ] 验证Android设备或Emulator可用

### 2. Flutter Android配置 (3h)
- [ ] 检查 `flutter_app/android/` 目录结构
- [ ] 配置 `android/app/src/main/AndroidManifest.xml`
  - 设置应用权限（INTERNET、CAMERA、READ_EXTERNAL_STORAGE等）
  - 配置应用图标
  - 配置应用名称
- [ ] 配置 `android/app/build.gradle`
  - 设置compileSdkVersion（34）
  - 设置minSdkVersion（21）
  - 设置targetSdkVersion（34）
  - 配置应用签名（开发阶段使用debug签名）
- [ ] 更新 `android/app/build.gradle` 版本号和版本名称
- [ ] 配置ProGuard混淆规则（Release构建）

### 3. Android特定功能实现 (3h)
- [ ] 适配Android Material Design组件
- [ ] 配置Android推送通知权限（Android 13+）
- [ ] 适配Android返回键行为
- [ ] 配置Android应用图标
  - 使用 `flutter_launcher_icons` 包
  - 生成Android应用图标（多种分辨率）
- [ ] 配置Android启动屏幕
- [ ] 适配Android深色模式（如果支持）
- [ ] 配置Android权限请求时机（运行时权限）

### 4. Android构建和测试 (3h)
- [ ] 在Android Emulator或设备上运行测试
  ```bash
  flutter run -d android
  ```
- [ ] 验证所有核心功能在Android上正常工作
  - 登录注册
  - 商品浏览
  - 购物车
  - 下单支付
  - 订单管理
  - 评价功能
  - 个人中心
- [ ] 测试Android特定功能
  - 返回键导航
  - 权限请求对话框
  - 通知权限（Android 13+）
  - Material Design组件
- [ ] 性能测试
  - App启动时间
  - 页面切换流畅度
  - 内存占用
  - APK大小

### 5. Android Release构建 (1h)
- [ ] 配置Android签名密钥（keystore）
- [ ] 配置 `key.properties` 文件
- [ ] 更新 `app/build.gradle` 签名配置
- [ ] 构建Release APK
  ```bash
  flutter build apk --release
  ```
- [ ] 构建App Bundle（用于Google Play）
  ```bash
  flutter build appbundle --release
  ```
- [ ] 验证Release版本功能正常

## 验收标准

### 必须满足
- [ ] ✅ Flutter Doctor显示Android环境正常
- [ ] ✅ App可以在Android Emulator/设备上成功运行
- [ ] ✅ 所有核心功能在Android上测试通过
- [ ] ✅ Android权限请求正常工作
- [ ] ✅ Material Design组件正确显示
- [ ] ✅ Release APK/AAB构建成功
- [ ] ✅ 应用图标和启动屏幕正确显示

### 可选
- [ ] 真机测试通过（多种Android版本）
- [ ] 性能指标达标（启动时间 < 3秒）
- [ ] APK大小 < 50MB
- [ ] 内存占用 < 200MB

## 技术细节

### Android权限配置示例
```xml
<!-- android/app/src/main/AndroidManifest.xml -->
<uses-permission android:name="android.permission.INTERNET" />
<uses-permission android:name="android.permission.CAMERA" />
<uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
<uses-permission android:name="android.permission.POST_NOTIFICATIONS" />
```

### build.gradle配置
```gradle
android {
    compileSdkVersion 34

    defaultConfig {
        applicationId "com.restaurant.deliveryapp"
        minSdkVersion 21
        targetSdkVersion 34
        versionCode 1
        versionName "1.0.0"
    }

    buildTypes {
        release {
            minifyEnabled true
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
            signingConfig signingConfigs.release
        }
    }
}
```

### 版本配置
```
minSdkVersion: 21 (Android 5.0 Lollipop)
targetSdkVersion: 34 (Android 14)
compileSdkVersion: 34
```

## 依赖关系
- 依赖任务006（Flutter基础框架）
- 依赖任务007（Flutter核心功能）
- 可与任务011（iOS配置）并行执行

## 工作目录
```
/Volumes/545S/general final/flutter_app
```

## 注意事项
1. Android开发可以在Windows/macOS/Linux上进行
2. Emulator测试需要HAXM或Hyper-V支持
3. 真机测试需要开启USB调试
4. Android 13+需要POST_NOTIFICATIONS权限才能显示通知
5. Google Play要求targetSdkVersion必须是近期版本

## 下一步
完成Android配置后，继续进行Google Play发布准备（任务015）
