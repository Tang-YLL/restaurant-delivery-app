---
name: 数据准备 - Material文件解析与数据库初始化
status: open
created: 2025-12-31T13:44:17Z
updated: 2025-12-31T13:44:17Z
github: [Will be updated when synced to GitHub]
depends_on: []
parallel: true
conflicts_with: []
---

# Task: 数据准备 - Material文件解析与数据库初始化

## Description
解析Material文件夹中的3668个JSON商品数据文件，配置静态文件服务，进行商品分类整理，初始化数据库并验证数据完整性。

## Acceptance Criteria
- [ ] 成功解析Material文件夹中所有3668个JSON文件
- [ ] FastAPI静态文件服务配置完成（/static路由可访问Material/material目录）
- [ ] 从菜品名称自动提取并创建分类标签（热菜、凉菜、汤类、主食、饮品、小吃等）
- [ ] 数据库初始化脚本执行成功，所有商品数据导入完成
- [ ] 数据验证脚本完成：JSON完整性检查、图片文件存在性验证
- [ ] 生成数据导入报告（成功数量、失败数量、错误详情）

## Technical Details

### 实现方法
1. **JSON文件解析**
   - 使用Python `json` 模块批量读取Material文件夹
   - 异步处理提升解析速度（asyncio + aiofiles）
   - 错误处理：记录无效JSON文件路径和错误原因

2. **静态文件服务**
   - FastAPI配置：`app.mount("/static", StaticFiles(directory="Material/material"), name="static")`
   - 图片路径格式：`/static/images/xxx.jpg`

3. **商品分类提取**
   - 基于规则匹配：菜品名称关键词（如"宫保鸡丁"→热菜，"凉拌"→凉菜）
   - 使用jieba分词辅助分类
   - 创建分类表（categories）和商品-分类关联表（product_categories）

4. **数据库初始化**
   - 设计category和product表结构
   - 批量插入（bulk_insert_mappings）提升性能
   - 使用SQLAlchemy ORM或直接SQL

5. **数据验证**
   - JSON schema验证（必需字段：name, price, image）
   - 图片文件存在性检查（os.path.exists）
   - 重复数据检测（基于name或唯一标识）

### 涉及的文件
- `/Volumes/545S/general final/Material/` - JSON数据源
- `/Volumes/545S/general final/scripts/import_products.py` - 数据导入脚本
- `/Volumes/545S/general final/scripts/validate_data.py` - 数据验证脚本
- `/Volumes/545S/general final/backend/app/main.py` - FastAPI静态文件配置
- `/Volumes/545S/general final/backend/models/` - 数据库模型

### 技术要点
- Python文件I/O和JSON处理
- FastAPI StaticFiles中间件
- SQLAlchemy批量操作
- 异步编程（asyncio）
- 正则表达式和字符串匹配
- 错误日志记录

## Dependencies
- [ ] Python 3.10+环境
- [ ] Material文件夹完整（包含3668个JSON文件和对应图片）
- [ ] 数据库环境（PostgreSQL/MySQL）

## Effort Estimate
- Size: M
- Hours: 16小时
  - JSON解析脚本：4小时
  - 分类规则开发：3小时
  - 数据库设计：3小时
  - 导入和验证脚本：4小时
  - 测试和调试：2小时
- Parallel: true（可与其他Phase 0任务并行）

## Definition of Done
- [ ] 数据导入脚本可执行且无报错
- [ ] 所有3668个商品成功导入数据库
- [ ] 静态文件服务可访问图片（测试http://localhost:8000/static/images/xxx.jpg）
- [ ] 分类表至少包含6个主要分类
- [ ] 数据验证报告显示100%数据完整性
- [ ] 代码通过类型检查（mypy）
- [ ] 包含使用说明文档（README.md）
